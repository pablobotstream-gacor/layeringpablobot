<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XAU Layer Simulator (v7.0 Floating & Price Manual)</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#f97316;
      --muted:#94a3b8;
      --glass:rgba(255,255,255,0.03);
    }
    html,body{
      height:100%;margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
      background:linear-gradient(180deg,#071028 0%,#071a2a 100%);
      color:#e6eef8;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:24px;
    }
    .container{
      width:100%;
      max-width:900px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .card{
      background:var(--card);
      border-radius:16px;
      padding:22px;
      box-shadow:0 8px 25px rgba(2,6,23,0.6);
      width:100%;
      text-align:center;
    }
    h1{margin:0 0 10px;font-size:20px;text-align:center}
    .muted{color:var(--muted);font-size:13px;text-align:center}
    .row{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:12px;
      margin-top:14px;
    }
    input[type=number],select{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.05);
      padding:10px;
      border-radius:10px;
      color:#e6eef8;
      width:100%;
      text-align:center;
      font-weight:500;
    }
    label{
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
      display:block;
      text-align:center;
    }
    .half{
      flex:1;
      min-width:160px;
      max-width:220px;
    }
    button{
      background:var(--accent);
      border:0;
      color:#06111a;
      padding:10px 14px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
    }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      text-align:center;
    }
    th,td{
      padding:8px;
      border-bottom:1px dashed rgba(255,255,255,0.06);
      font-size:13px;
    }
    th{
      color:var(--muted);
      background:var(--card);
      position:sticky;
      top:0;
    }
    .summary{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:12px;
      margin-top:16px;
    }
    .pill{
      background:rgba(255,255,255,0.05);
      padding:10px 14px;
      border-radius:12px;
      min-width:150px;
      text-align:center;
    }
    .profit{color:#22c55e;font-weight:600;}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>XAU Layer Simulator (v7.0 Floating & Price Manual)</h1>
      <div class="muted">Simulasikan layering otomatis BUY/SELL dengan modal per layer & perhitungan floating real-time berdasarkan harga manual</div>

      <div class="row">
        <div class="half">
          <label>Modal per Layer (USD)</label>
          <input id="perLayer" type="number" value="100" />
        </div>
        <div class="half">
          <label>Harga Open Pertama (USD)</label>
          <input id="basePrice" type="number" value="4121" step="0.01" />
        </div>
      </div>

      <div class="row">
        <div class="half">
          <label>Harga Saat Ini (Manual)</label>
          <input id="currentPrice" type="number" value="4121" step="0.01" />
        </div>
        <div class="half">
          <label>Jarak Antar Layer (USD)</label>
          <input id="step" type="number" value="50" />
        </div>
      </div>

      <div class="row">
        <div class="half">
          <label>Lot per Layer</label>
          <input id="lot" type="number" value="0.01" step="0.01" />
        </div>
        <div class="half">
          <label>Arah Posisi</label>
          <select id="direction">
            <option value="buy">BUY (Long)</option>
            <option value="sell">SELL (Short)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="half">
          <label>Jumlah Layer Aktif</label>
          <input id="activeLayers" type="number" value="3" min="1" />
        </div>
        <div class="half">
          <label>Kurs USD ke IDR</label>
          <input id="usdToIdr" type="number" value="16000" />
        </div>
      </div>

      <div class="row" style="margin-top:8px;">
        <button id="calc">Hitung Otomatis</button>
      </div>

      <table id="table" style="display:none">
        <thead>
          <tr>
            <th>Layer</th>
            <th>Harga Entry</th>
            <th>Total Lot</th>
            <th>Total Modal</th>
            <th>Floating</th>
            <th>Equity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="summary" class="summary"></div>
    </div>
  </div>

  <script>
    const el = id => document.getElementById(id);
    const format = n => Number(n).toLocaleString('en-US',{maximumFractionDigits:2});

    function compute(){
      const basePrice = +el('basePrice').value;
      const currentPrice = +el('currentPrice').value;
      const perLayer = +el('perLayer').value;
      const step = +el('step').value;
      const lot = +el('lot').value;
      const dir = el('direction').value;
      const activeLayers = Math.max(+el('activeLayers').value, 1);
      const usdToIdr = +el('usdToIdr').value;

      const tbody = el('table').querySelector('tbody');
      tbody.innerHTML = '';
      el('table').style.display = '';

      let totalLot = 0, weightedSum = 0, totalFloating = 0;

      // Generate layer entries
      const entries = [];
      for(let i=0;i<activeLayers;i++){
        const entry = dir==='buy' ? basePrice - (step*i) : basePrice + (step*i);
        entries.push(entry);
      }

      // Urutkan dari atas ke bawah
      entries.sort((a,b)=>dir==='buy'?b-a:a-b);

      entries.forEach((entry,i)=>{
        totalLot += lot;
        const totalModal = perLayer * (i+1);
        weightedSum += entry * lot;

        const floating = dir==='buy'
          ? (currentPrice - entry) * (lot * 100)
          : (entry - currentPrice) * (lot * 100);

        totalFloating += floating;
        const equity = totalModal + totalFloating;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${format(entry)}</td>
          <td>${totalLot.toFixed(2)}</td>
          <td>$${format(totalModal)}</td>
          <td>${floating>=0 ? '$'+format(floating) : '-$'+format(Math.abs(floating))}</td>
          <td>$${format(equity)}</td>
        `;
        tbody.appendChild(tr);
      });

      // Harga rata-rata semua entry
      const breakEven = weightedSum / totalLot;

      let breakEvenLayer = 1;
      for(let i=0;i<entries.length;i++){
        if((dir==='buy' && breakEven<=entries[i]) || (dir==='sell' && breakEven>=entries[i])){
          breakEvenLayer = i+1;
          break;
        }
      }

      // Profit jika kembali ke harga awal
      const firstEntry = entries[0];
      let profitIfReturn = 0;
      entries.forEach(entry=>{
        profitIfReturn += dir==='buy'
          ? (firstEntry - entry) * (lot * 100)
          : (entry - firstEntry) * (lot * 100);
      });

      const totalDeposit = perLayer * activeLayers;

      el('summary').innerHTML = `
  <div class="pill"><b>Layer aktif:</b><br>${activeLayers}</div>
  <div class="pill"><b>Total deposit:</b><br>$${format(totalDeposit)}</div>
  <div class="pill"><b>Total lot:</b><br>${format(totalLot)}</div>
  <div class="pill" style="color:#ef4444;">
    <b>Floating total:</b><br>
    $${format(totalFloating)}<br>
    <span style="color:#ef4444;">≈ Rp ${format(totalFloating * usdToIdr)}</span>
  </div>
  <div class="pill profit">
    <b>Profit jika kembali ke harga awal:</b><br>
    $${format(profitIfReturn)}<br>
    <span style="color:#94a3b8;">≈ Rp ${format(profitIfReturn * usdToIdr)}</span>
  </div>
  <div class="pill">
    <b>Harga break-even:</b><br>${format(breakEven)} USD<br>
    <span style="color:#94a3b8;">(Layer ke-${breakEvenLayer})</span>
  </div>
`;

    }

    el('calc').addEventListener('click', compute);
    el('currentPrice').addEventListener('input', compute);
    compute();
  </script>
</body>
</html>
